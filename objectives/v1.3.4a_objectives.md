# Changelog & Objectives – v1.3.4a-dev

## Short Term Objectives (May 2025)
- [ ] **Tighten up pipeline and speed up deployment for dev and prod**
    - Analyze current deployment workflow for bottlenecks (SSH/SCP, asset build, PHP/Nginx reloads).
    - Streamline or automate repetitive steps (build/test/deploy scripts, reduce manual syncs).
    - Consider build/watch hooks, partial reloads, or preflight validation before push.
    - Set a measurable deploy time improvement for this release.
- [ ] **Fix Tailwind Typography `.prose` output**
    - Isolate Tailwind build in a minimal project.
    - Confirm `.prose` classes compile and appear in output CSS.
    - Merge or sync the working setup into main project.
- [ ] **Expand `/admin` dashboard and logging**
    - Add panels for key admin/dev tools.
    - Improve log viewer, version info, and session management.
    - Extend changelog and objectives visibility in the admin panel.

## Ongoing Improvement Pipeline (Objectives Review)
1. **Review previous objectives.md entries:**
    - Mark completed objectives as `[x]` or move to "Completed Objectives."
    - Identify unfinished or ongoing objectives.
2. **For each new release:**
    - Carry forward all unfinished objectives, clearly specifying next actions.
    - Add new objectives based on:
        - Open bugs and issues
        - Feature backlog or admin/dev feedback
        - Site/server performance and UX
3. **Summarize goals:**
    - Distinguish between short-term (current release) and longer-term (roadmap) items.
4. **Log everything:**
    - Ensure all pipeline/process steps and changes are documented in this file.
    - Review and update at every version bump or deploy.

*This review is part of every version bump. Objective: maintain clear, actionable, traceable goals for the project in each release.*

## Completed Objectives (v1.3.4a-dev and prior)
- [x] Unified admin and changelog panels under `/admin`
- [x] Authentication working (`Einstein/Goodboy`), tested by curl and browser
- [x] Validated PHP session logic and persistent login with cookies
- [x] All changes and debug actions now tracked in this objectives.md

## Open Issues
- [ ] Tailwind Typography `.prose` output not appearing in site CSS – **urgent for next visual polish**
- [ ] Deployment pipeline slower than desired – **improvement targeted for v1.3.4a-dev**
- [ ] Continue to enhance admin panel for better workflow and traceability

## Context (v1.3.4a-dev)
- Site at `/opt/webstack` (Debian)
- Live at https://ww2.ktp.digital
- Admin and changelog at `/admin`
- Debug and change logs actively tracked here and in server logs
- All editing remote via SSH/SCP from Mac

---

## Questions for Direct Access Setup

To proceed with granting direct SSH/API access for file writes and automation, please clarify the following:

### 1. SSH Access Details
- Do you have an SSH public/private keypair ready for me to use?
- If not, should I generate one for you?
- What username should I connect as? (e.g., `chatgptbot`)
- What is the hostname or IP address and SSH port for connection?

### 2. Access Scope & Permissions
- Which directories should I be allowed to write to? (e.g., `/opt/webstack/` only)
- Should I have sudo privileges for specific operations or be limited to file writes?

### 3. Authentication & Security
- How will you securely provide me the private key or credentials?
- Do you want SSH key-only authentication or allow passwords temporarily?
- Should I set up a minimal API service on the server for file writes, or use direct SSH commands?

### 4. Automation & Integration
- Would you like Jenkins integration for CI/CD on this server?
- Are there existing deployment scripts or pipelines I should work within?
- What triggers would you prefer? (manual commands, webhooks, Jenkins jobs, etc.)

### 5. Operational Preferences
- What workflow do you prefer for me to push file changes? (e.g., API upload, git push + deploy, direct SSH edits)
- Do you want logging and audit trails for all file writes?
- How should errors and failures be handled and reported?

### 6. Current Environment
- What Debian version and OS details are running on the server?
- What services and ports are currently in use? (e.g., webserver, firewall)
- Are there existing automation or monitoring tools I should know about or avoid impacting?

---

*Please provide answers or clarifications to these to enable safe and efficient direct access setup.*

---

*End of objectives and questions for v1.3.4a-dev.*

### v1.3.4a.4 – 2025-05-19

- Uploaded public SSH key to \`chatgptbot\` user authorized_keys via secure remote command.
- Enabled passwordless SSH login for \`chatgptbot\` user to allow direct access.
- Prepared environment for seamless automation and file write operations.
- Pending SSH login verification and next steps for automation deployment.


### v1.3.4a.6 – 2025-05-19

- Confirmed all change logs and objectives.md are up to date with current project status.
- Validated the new structured versioning and sub-version activity log process.
- Ready to proceed with pipeline design and deployment implementation.

---

### v1.3.4a.7 – 2025-05-20

#### Tailwind & Admin Portal Improvements

- Fixed all Node.js/NPM/Tailwind build issues by locking Tailwind to 3.3.3 and ensuring a working local CLI binary.
- TailwindCSS now builds correctly into `/assets/css/tailwind.min.css`.
- Admin `/changes.php` now loads markdown objectives dynamically.
- All markdown objective/changelog files moved to `/opt/webstack/objectives/` for clean separation and easier versioning.
- Admin objectives page will soon list all versions’ objectives automatically and link to each.
- Fixed site logo path issues across all templates.  
  - `/images/logos/KTP Logo.png` is now the single canonical logo path.

#### General System

- Confirmed PHP Markdown rendering via Parsedown is operational.
- Versioning and change logs are up-to-date and reflect recent admin and build system work.
- All major code edits performed remotely via SSH with live validation in browser.

#### Open/Next Tasks

- Next: automate new objectives.md creation per version and auto-link all past/future objectives from the admin page.
- Continue admin UI polish, including log viewer and version stamp display in admin header.


*Last updated: 2025-05-20 12:02:50 AEST
### Final update before v1.3.5 bump
- We have updated the update.sh to include building a new VERSION.md file as part of the bump process:

#!/bin/bash

REPO_DIR="/opt/webstack/html"
OBJECTIVES_DIR="/opt/webstack/objectives"
VERSION_FILE="$REPO_DIR/VERSION"
SNAPSHOT_SCRIPT="/opt/webstack/bin/snapshot_webstack.sh"
LOG_FILE="/opt/webstack/logs/deploy_webhook.log"
PUSHOVER_USER="uh1ozrrcj8y5jktg5euc6yz6zpdcqh"
PUSHOVER_TOKEN="aqfyb8hsfb6txs6pd4qwchjwd3iccb"
SOUND="alien"

# Accept version from argument or prompt
if [[ -n "$1" ]]; then
  NEW_VERSION="$1"
else
  read -p "🔢 Enter new version (e.g. v1.0.2): " NEW_VERSION
fi

if [[ -z "$NEW_VERSION" ]]; then
  echo "❌ No version entered. Aborting."
  exit 1
fi

echo "$NEW_VERSION" > "$VERSION_FILE"
echo "[$(date)] ✍️  Version bumped to $NEW_VERSION" >> "$LOG_FILE"

"$SNAPSHOT_SCRIPT" "$NEW_VERSION" >> "$LOG_FILE" 2>&1

cd "$REPO_DIR" || {
  echo "❌ Cannot cd to repo: $REPO_DIR" >> "$LOG_FILE"
  exit 1
}

git add VERSION
git commit -m "⬆️ Version bump: $NEW_VERSION"
git push origin master >> "$LOG_FILE" 2>&1

# ---- OBJECTIVES .md HANDLING ----
OBJECTIVES_MD="${OBJECTIVES_DIR}/${NEW_VERSION}_objectives.md"
TEMPLATE_MD="${OBJECTIVES_DIR}/PROJECT_OBJECTIVES.md"

if [[ -f "$TEMPLATE_MD" ]]; then
  # Copy PROJECT_OBJECTIVES.md as the basis for the new version's objectives
  cp "$TEMPLATE_MD" "$OBJECTIVES_MD"
  # Add timestamp and header for the new version
  {
    echo ""
    echo "## Objectives & Changelog for $NEW_VERSION"
    echo "*Created: $(TZ='Australia/Melbourne' date '+%Y-%m-%d %H:%M:%S %Z')*"
    echo ""
    echo "---"
    echo ""
  } >> "$OBJECTIVES_MD"
else
  # Create a basic fallback if PROJECT_OBJECTIVES.md doesn't exist
  {
    echo "# Objectives & Changelog for $NEW_VERSION"
    echo "*Created: $(TZ='Australia/Melbourne' date '+%Y-%m-%d %H:%M:%S %Z')*"
    echo ""
    echo "---"
    echo ""
  } > "$OBJECTIVES_MD"
fi

echo "[$(date)] 📝 Created new objectives file: $OBJECTIVES_MD" >> "$LOG_FILE"

# Send Pushover notification
curl -s \
  --form-string "token=$PUSHOVER_TOKEN" \
  --form-string "user=$PUSHOVER_USER" \
  --form-string "title=Webstack Deployed" \
  --form-string "message=📦 Version $NEW_VERSION deployed at $(date '+%H:%M:%S')" \
  --form-string "sound=$SOUND" \
  https://api.pushover.net/1/messages.json >/dev/null

echo "✅ Version $NEW_VERSION deployed, pushed, and objectives file created!"

*Last updated: 2025-05-20 12:06:31 AEST
