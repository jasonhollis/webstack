# v2.0.5 Objectives - Database Logging Migration Phase 2

## <¯ Primary Goal: Implement Fallback Mechanism (Week 1-2 of Migration)

### Immediate Next Steps (When you return):
1. **Create error_logs table** - The table doesn't exist yet, causing warnings
2. **Implement emergency.log fallback** - Single file for DB outages
3. **Add queue/retry logic to DatabaseLogger** - Handle temporary DB issues
4. **Test fallback scenarios** - Stop MySQL and verify emergency logging works

### Phase 2 Checklist (Current Phase):
- [ ] Create error_logs table in database
- [ ] Enhance DatabaseLogger with queue/retry logic
- [ ] Create single emergency.log for database outages
- [ ] Implement automatic queue flush via cron (every minute)
- [ ] Add database health check monitoring
- [ ] Test fallback scenarios (stop MySQL, verify emergency logging)

### Upcoming Phases (For Reference):
- **Phase 3 (Week 2)**: Create admin log viewer
- **Phase 4 (Week 3-4)**: 2-week parallel logging validation
- **Phase 5 (Week 5)**: Deprecate file logs (except emergency.log)

### What We've Completed (Phase 1 ):
- Dual logging in update_version.py
- Dual logging in failure.py  
- Dual logging in snapshot_webstack.py
- All scripts tested and working with graceful fallback

### Quick Test Commands:
```bash
# Test failure logging (should warn about missing error_logs table)
python3 /opt/webstack/bin/failure.py "test" "Testing Phase 2"

# Check current operation logs
echo "SELECT * FROM operation_logs ORDER BY id DESC LIMIT 5;" | mariadb -u root ktp_digital

# When ready to test fallback (Phase 2):
# systemctl stop mariadb
# python3 /opt/webstack/bin/update_version.py v2.0.6-test
# Check emergency.log was created
# systemctl start mariadb
```

### Notes for Next Session:
- The error_logs table needs to be created first
- DatabaseLogger currently just skips on DB failure (good for now)
- Consider adding a status indicator to admin panel showing logging health
- Remember: Server snapshots available for rollback if needed

---
*Migration Timeline: Started Week 1 (Aug 12), Target completion Week 5-6*