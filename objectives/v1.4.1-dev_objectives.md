# PROJECT_OBJECTIVES.md

## KTP Website: Project Objectives

This project delivers a secure, modern web presence for KTP Digital, built for easy management, analytics, and continual improvement.

### Core Goals:
- Provide a simple, maintainable, and secure PHP/Tailwind website
- Support rapid deployment and rollback using ZIP snapshots and Git
- Centralize all administration and analytics under `/admin`
- Log and visualize site usage for ongoing market segmentation and SEO optimization
- Ensure that objectives and change history are always visible and versioned
- Enable seamless future migration from `ww2.ktp.digital` to `www.ktp.digital` with no hardcoded subdomain logic
- Keep all navigation and assets relative or config-driven for environment portability

### Admin/Analytics Roadmap:
- Admin hub at `/admin/`
- Download any snapshot or log file from the admin panel
- Track pageviews, user agents, referers, and IPs for traffic analysis
- Show version and objectives history in a human-readable form
- Allow secure access (username+password, then later OIDC or SSO)
- Future: Expose key site settings and SEO controls to admin panel

---
### Remote Workflow Support:
- All project management, file editing, and admin must be fully operable via SSH and SCP from a Mac (or other remote system)
- No required steps may assume local desktop GUI access; everything must be executable from a remote shell/editor (vim/nano) or via secure file copy
- All code, admin tools, and setup steps must support headless remote operation (no manual web uploads or GUI installers)

## Objectives & Changelog for v1.4.1-dev
*Created: 2025-05-20 15:23:45 AEST*

---


---
#### [2025-05-20 16:21:27 AEST][v1.4.1-dev]
Add analytics dashboard with:

- üìà Graphs of traffic by date
- User agent breakdown
- Referrer analytics

Include link to `/admin/analytics.php`.

---
#### [2025-05-20 16:24:08 AEST][v1.4.1-dev]
üöÄ BBEdit + Automator + SSH: Project Objectives Logging ‚Äî Success!
Here‚Äôs a concise, styled summary of the streamlined system you just built:

üîπ Goal

Create a frictionless, rich-markup-friendly workflow for logging project objectives, directly from BBEdit into your versioned objectives log on a remote server.

üîπ Tools Used

BBEdit: For composing objectives (with full Markdown/emoji support), and for managing/editing server files over SFTP.
Automator (Quick Action/Service): For a system-wide right-click or shortcut to send selected text to the logging script over SSH.
SSH + Bash Script: Ensures objectives are appended with timestamp and version, maintaining auditability and history.

---
#### [2025-05-20 16:24:41 AEST][v1.4.1-dev]
üöÄ BBEdit + Automator + SSH: Project Objectives Logging ‚Äî Success!
Here‚Äôs a concise, styled summary of the streamlined system you just built:

üîπ Goal

Create a frictionless, rich-markup-friendly workflow for logging project objectives, directly from BBEdit into your versioned objectives log on a remote server.

üîπ Tools Used

BBEdit: For composing objectives (with full Markdown/emoji support), and for managing/editing server files over SFTP.
Automator (Quick Action/Service): For a system-wide right-click or shortcut to send selected text to the logging script over SSH.
SSH + Bash Script: Ensures objectives are appended with timestamp and version, maintaining auditability and history.

---
#### [2025-05-20 16:25:24 AEST][v1.4.1-dev]
Fix The Changes page

---
#### [2025-05-20 16:25:42 AEST][v1.4.1-dev]
Fix the maintenance page

---
#### [2025-05-20 16:29:13 AEST][v1.4.1-dev]
Objectives for the next changes.php iteration

Fix scrolling and ensure you can always reach the top of the page.
Make each file ‚Äúcard‚Äù clickable:
Clicking on a file card opens a clean, full-page view of that file‚Äôs complete content (rendered as Markdown).
This view includes an easy ‚ÄúDownload‚Äù button (or icon) for the file.
(Optional polish): Add a ‚ÄúBack‚Äù button or breadcrumb to return to the objectives/change log list.
How we‚Äôll approach it:

A. Fixing Scrolling / Layout
Add padding to the top of the container below the navbar.
Make sure the scroll region isn‚Äôt clipped by sticky/fixed headers.
B. Clickable Cards ‚Üí Full-Page File View
Each card‚Äôs filename is a link (or make the whole card clickable) to changes.php?file=FILENAME.
When ?file=FILENAME is present, show a full-width, scrollable markdown render of the entire file, with a download button.
C. Download Option
Add a download button (could be a link or icon) in the file view, which sends the raw file for download with correct headers.

---
#### [2025-05-20 16:30:05 AEST][v1.4.1-dev]
Built new EOF of changes.php

cat << 'EOF' > /opt/webstack/html/admin/changes.php
<?php
// Path config
$objectives_dir = '/opt/webstack/objectives';
$allowed_exts = ['md', 'txt'];
$files = array_filter(scandir($objectives_dir), function($f) use ($allowed_exts) {
    $ext = pathinfo($f, PATHINFO_EXTENSION);
    return in_array($ext, $allowed_exts) && !is_dir("$objectives_dir/$f");
});

// Handle file view or download
if (isset($_GET['file'])) {
    $file = basename($_GET['file']);
    $filepath = "$objectives_dir/$file";
    if (!in_array($file, $files)) {
        http_response_code(404);
        echo "File not found";
        exit;
    }

    // Download
    if (isset($_GET['download'])) {
        header('Content-Type: application/octet-stream');
        header('Content-Disposition: attachment; filename="' . $file . '"');
        readfile($filepath);
        exit;
    }

    // File content view
    $content = file_get_contents($filepath);
    // Basic Markdown rendering (just line breaks, or use a parser if available)
    function md_escape($s) { return htmlspecialchars($s, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8'); }
    $rendered = '<pre class="prose max-w-full bg-gray-100 dark:bg-gray-800 rounded-xl p-4 overflow-x-auto text-sm">'.md_escape($content).'</pre>';
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Objectives & Change Log ‚Äì KTP Digital</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="/assets/tailwind.min.css">
    <style>
      .prose pre { background: inherit; }
    </style>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white">
<?php include '../nav.php'; ?>
<div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8 flex items-center gap-3">üóÇÔ∏è Objectives & Change Log</h1>
    <?php if (isset($file)): ?>
        <div class="mb-4 flex items-center gap-4">
            <a href="changes.php" class="text-blue-500 hover:underline flex items-center">&larr; Back to list</a>
            <a href="changes.php?file=<?=urlencode($file)?>&download=1" class="ml-auto bg-blue-500 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700">Download</a>
        </div>
        <div class="bg-white dark:bg-gray-900 border rounded-2xl shadow p-6">
            <div class="mb-2 font-bold text-lg"><?=md_escape($file)?></div>
            <?=$rendered?>
        </div>
    <?php else: ?>
        <div class="grid gap-6">
        <?php foreach ($files as $f): ?>
            <a href="changes.php?file=<?=urlencode($f)?>" class="block bg-white dark:bg-gray-800 border rounded-xl shadow hover:shadow-lg transition p-5">
                <span class="font-mono font-bold text-lg"><?=md_escape($f)?></span>
                <span class="block text-gray-500 text-xs mt-1">
                    <?=date('Y-m-d H:i', filemtime("$objectives_dir/$f"))?>
                </span>
                <span class="block truncate mt-2 text-gray-800 dark:text-gray-200 text-sm">
                    <?=mb_substr(md_escape(@file_get_contents("$objectives_dir/$f")),0,180)?>...
                </span>
            </a>
        <?php endforeach; ?>
        </div>
    <?php endif; ?>
</div>
</body>
</html>
EOF
chmod 644 /opt/webstack/html/admin/changes.php

---
#### [2025-05-20 16:40:45 AEST][v1.4.1-dev]
What went wrong:
The $objectives_dir variable is defined inside the first PHP block, but referenced in the global scope and in file list generation before that block runs.
The md_escape() function is declared inside an if block, but used outside or before it‚Äôs declared.

---
#### [2025-05-20 16:51:35 AEST][v1.4.1-dev]
Fix the maintenance page - New Objective

---
#### [2025-05-20 17:21:28 AEST][v1.4.1-dev]
Moved the maintenance.php into /admin
Did a complete rewrite of the file to tie it in 

---
#### [2025-05-20 17:24:09 AEST][v1.4.1-dev]
Next we will fix the download button 
Then we will add a delete button for changes

---
#### [2025-05-20 17:25:03 AEST][v1.4.1-dev]
Bumping to a new chat with the following lines:

Resume KTP Webstack project at v1.4.1-dev.

We just migrated the maintenance/snapshots page to /admin/maintenance.php and deleted the old /maintenance.php.
All admin pages use the new .admin-page wrapper and /assets/admin.css for navbar spacing.
Download button on the snapshots table is not rendering correctly (SVG/icon/label alignment or link issue).
Next task: Fix the download button/link display and make sure all actions are pixel-perfect.
All future patches should be delivered as strict EOF file blocks for SSH/vim use, matching my workflow.
Continue with no onboarding, just address the next deliverable.

---
#### [2025-05-20 17:49:02 AEST][v1.4.1-dev]
Perfect‚Äîthis confirms that the SVG and label are present in the HTML but not visible.
That means Tailwind‚Äôs text color classes (text-white, etc.) are working, but the SVG‚Äôs content is missing.
This is a classic issue if:

The SVG <path> has no visible stroke or fill,
Or Safari blocks the icon due to malformed SVG (sometimes happens with copy-pasted icons),
Or there‚Äôs a CSS rule hiding child elements.
But your screenshot shows the svg has the right classes, and the HTML source is good. The issue is the SVG path is present, but you see only a blank square.

Fix: Use a Different, Known-Good SVG or Emoji
Let‚Äôs test with a simpler SVG (a solid red X) and also with an emoji, so you always have a visible icon.

---
#### [2025-05-20 18:03:10 AEST][v1.4.1-dev]
None of GPT4.1's ideas on buttons for the snapshots download and delete were working
After 1 hour of playing with buttons I sugested that we use the old code and it worked in about 2 minutes

---
#### [2025-05-20 18:03:41 AEST][v1.4.1-dev]
Resume KTP Webstack project at v1.4.2-dev. All admin and public pages now use proven `<a>`/emoji-based action links for download/delete. Maintenance admin page is confirmed pixel-perfect, accessible, and secure. Next: [state your next objective here].

---
#### [2025-05-20 18:04:20 AEST][v1.4.1-dev]
bumping now with /opt/webstack/bin/update_version.sh v1.4.2-dev

