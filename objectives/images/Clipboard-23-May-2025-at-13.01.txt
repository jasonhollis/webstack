cat << 'EOF' > /opt/webstack/bin/restore_log_history.sh
#!/bin/bash
# restore_log_history.sh: Append non-empty rotated .bak logs into main log (preserves history)
# Usage: ./restore_log_history.sh access.log

LOGDIR="/opt/webstack/logs"
LOGNAME="$1"

if [[ -z "$LOGNAME" ]]; then
  echo "Usage: $0 <logname>   (e.g. access.log, error.log)"
  exit 1
fi

cd "$LOGDIR" || exit 2

# Check if log exists
if [[ ! -f "$LOGNAME" ]]; then
  echo "Log file $LOGDIR/$LOGNAME does not exist."
  exit 3
fi

COUNT=0
for bak in "$LOGNAME".bak.*; do
  if [[ -s "$bak" ]]; then
    cat "$bak" >> "$LOGNAME"
    COUNT=$((COUNT + 1))
    echo "Appended: $bak"
  fi
done

echo "âœ… Restored $COUNT non-empty .bak files into $LOGNAME"
EOF

chmod +x /opt/webstack/bin/restore_log_history.sh
