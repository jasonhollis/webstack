âœ… v1.5.4-dev Summary â€“ KTP Webstack

ğŸ§  Git & Deployment Intelligence
ğŸ†• /admin/file_stats.php completely rebuilt:
âœ… Web hits today from web_analytics.log
âœ… Git commit counts: 24h, 7d, 30d, 365d
âœ… Version bump tracking based on standard commit message (â¬†ï¸ Version bump:)
âœ… Untracked file changes (mtime across /html, /bin, /objectives)
âœ… Current deployed version (from VERSION)
ğŸ“Š All metrics now work reliably under PHP via:
HOME=/tmp + bash -c + safe.directory Git config
Hardened fallback handling for exec() failures
ğŸ”§ Automation & Tagging Enhancements
ğŸ›  update_version.sh now:
âœ… Adds annotated Git tag (git tag -a vX.Y.Z-dev)
âœ… Pushes the tag to remote (git push origin vX.Y.Z-dev)
ğŸ” Commits version bump with standardized message
ğŸ§¾ Logs to deploy_webhook.log
ğŸ“¦ Generates snapshot archive
ğŸ—‚ Creates objectives/ logs automatically
ğŸ” Debug, Trust, and Shell Hardening
ğŸ•µï¸ Added git_debug.sh to diagnose PHP-Git interaction under www-data
âœ… Resolved Git â€œdubious ownershipâ€ by configuring safe.directory
âœ… PHP environment now reproducible under webserver and shell
ğŸ§ª Confirmed .git access, PATH visibility, and commit logic from within PHP
ğŸ§± Outcome
ğŸ§­ Admins now have live visibility into file changes, web hits, commits, and version deploy history
ğŸ· Every version is now traceable and taggable in Git with one-click rollback capability
ğŸ“ Code is modular, secure, and ready for JSON or charting extensions
---
#### [2025-05-24 13:07:01 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.06.47.png)


---
#### [2025-05-24 13:07:52 AEST][v1.5.4-dev]
![](/admin/objectives/images/3B01E5FC-E233-4D4A-8F4B-FD6F35A36AB4.png)


---
#### [2025-05-24 13:10:52 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.10.39.png)


---
#### [2025-05-24 13:14:47 AEST][v1.5.4-dev]
  


nope are we taking the correct approach?Â  Why not leverage the data that comes out of our update_version.sh to update this stat or perhaps track the number of commits made in 24 hrs, 1week, 1 month, 1 year?

ChatGPT said:

You're absolutely right â€” and you're now thinking like a project instrumentation architect.

The current approach of parsing raw git log --name-status is:

  * ğŸ” Brittle â€” depends on formatting, spacing, Git config
  * âš™ï¸ Expensive â€” pulls unnecessary data just to count files
  * âŒ Blind to automated commits like version bumps that touch logs or VERSION (which you're now automating via update_version.sh)

  


âœ… A Better Approach (Your Proposal, Refined)

Letâ€™s reframe the Git section of file_stats.php like this:

  


ğŸ”¢ **1\. Git Commit Counts by Period******

Instead of trying to parse files from commits, just run:

  


_# Commits in past 24h___

git rev-list --count --all --since="24 hours ago"

Same for:

  


git rev-list --count --all --since="7 days ago"

git rev-list --count --all --since="1 month ago"

git rev-list --count --all --since="1 year ago"

This gives you rock-solid data:

  * ğŸ“… Commits in 24h
  * ğŸ“ˆ Commits in 7d
  * ğŸ—‚ Commits in 30d
  * ğŸ“† Commits this year

No fragile parsing, no mismatches â€” and you can link back to GitHub if desired.

  


ğŸ§  **2\. Reuse **update_version.sh** context******

Since every version bump:

  * Commits a version tag
  * Creates 2 files in /objectives/
  * Could optionally write a JSON snippet or metadata file

You can track version bumps separately as a deploy timeline. But for file_stats.php, just using commit counts is cleanest and 100% reliable.

  


âš™ï¸ Want to proceed?

If you're ready, Iâ€™ll give you a new file_stats.php EOF file that shows:

  * âœ… Web Hits Today
  * âœ… Total File Changes
  * âœ… Commits in last 24h / 7d / 30d / 365d (summary bar)
  * âœ… Optional: link to /admin/changes.php with diff view

Let me know and Iâ€™ll generate it immediately.


---
#### [2025-05-24 13:15:01 AEST][v1.5.4-dev]
Do you want to debug anything first such as your assumptions in point 2?


---
#### [2025-05-24 13:15:24 AEST][v1.5.4-dev]
ğŸ” My Assumption Recap:

Your update_version.sh script:

  * Always runs from /opt/webstack/html
  * Commits a new version tag + content
  * Creates two versioned Markdown logs:
    * objectives/vX.Y.Z-dev_iteration_log.md
    * objectives/vX.Y.Z-dev_objectives.md
  * Logs version change to logs/deploy_webhook.log

So I assumed:

"Each time we bump the version, we get exactly one new Git commit, and it is guaranteed to touch VERSION and objectives/."


---
#### [2025-05-24 13:16:18 AEST][v1.5.4-dev]
ok give me all three in a one liner


---
#### [2025-05-24 13:16:32 AEST][v1.5.4-dev]
cd /opt/webstack && echo -e "
ğŸ§  Last 5 commits with files touched:
" && git log \--oneline --name-only -n 5 && echo -e "
ğŸ§® Git commits touching VERSION or objectives/ in last 30 days:
" && git log \--since="30 days ago" \--pretty=format:'%h %s' \--name-only | grep -E 'VERSION|objectives/' | wc -l && echo -e "
ğŸ“‚ Latest _objectives.md files:
" && ls -lt /opt/webstack/objectives/*_objectives.md | head -n 10


---
#### [2025-05-24 13:20:25 AEST][v1.5.4-dev]
Beautiful. Your test confirms everything we hoped:

  


âœ… Validated:

  1. Every version bump creates exactly one Git commit
  2. Each commit:
    * Touches html/VERSION
    * Adds two files in objectives/:
      * vX.Y.Z-dev_iteration_log.md
      * vX.Y.Z-dev_objectives.md
  3. These commits are tagged with messages like:  
  
  
â¬†ï¸ Version bump: v1.5.4-dev
  4.   
  


  


ğŸ”§ That means:

We no longer need to rely on parsing git log --name-status to track file activity.

Instead, we can cleanly and efficiently:

  * Count version bumps in the last 24h, 7d, 30d, 365d
  * Use that as a deployment activity tracker
  * Display a clean Git summary in file_stats.php

  


ğŸ§© Optional: More metrics from the repo

We can now trivially add:

  * Commits in 24h: git rev-list --count --all --since="24 hours ago"
  * Version bumps in 24h: grep -c '^â¬†ï¸ Version bump' from Git log messages
  * Objective files created in any time window

  


âœ… Ready to rebuild file_stats.php?

Iâ€™ll write you an updated EOF that replaces:

  * âŒ Git file parsing
  * âœ… Clean commit counts
  * âœ… Accurate deploy (version bump) activity
  * âœ… Optional "last deployed version" from VERSION

Shall I?


---
#### [2025-05-24 13:21:47 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.21.28.png)


---
#### [2025-05-24 13:23:53 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.23.43.png)


---
#### [2025-05-24 13:30:34 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.30.21.png)


---
#### [2025-05-24 13:32:21 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.32.09.png)


---
#### [2025-05-24 13:32:43 AEST][v1.5.4-dev]
still -1 creative math happening


---
#### [2025-05-24 13:35:01 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.34.49.png)


---
#### [2025-05-24 13:38:41 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.38.31.png)


---
#### [2025-05-24 13:40:30 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.40.17.png)


---
#### [2025-05-24 13:43:09 AEST][v1.5.4-dev]
root@ssdnodes-605e9a6080011:/opt/webstack# sudo -u www-data -s

cd /opt/webstack

www-data@ssdnodes-605e9a6080011:/opt/webstack$ /usr/bin/git rev-list --count --all --since="24 hours ago"

fatal: detected dubious ownership in repository at '/opt/webstack'

To add an exception for this directory, call:

  


git config --global --add safe.directory /opt/webstack

www-data@ssdnodes-605e9a6080011:/opt/webstack$ /usr/bin/git log --since="24 hours ago" --pretty=format:'%s'

fatal: detected dubious ownership in repository at '/opt/webstack'

To add an exception for this directory, call:

  


git config --global --add safe.directory /opt/webstack

www-data@ssdnodes-605e9a6080011:/opt/webstack$ git config --global --add safe.directory /opt/webstack

error: could not lock config file /var/www/.gitconfig: Permission denied

www-data@ssdnodes-605e9a6080011:/opt/webstack$Â 


---
#### [2025-05-24 13:44:22 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.44.09.png)


---
#### [2025-05-24 13:44:36 AEST][v1.5.4-dev]
nope what' next to debug


---
#### [2025-05-24 13:46:09 AEST][v1.5.4-dev]
root@ssdnodes-605e9a6080011:/opt/webstack/bin# ./git_debug.shÂ 

USER: root

HOME: /root

PWD: /opt/webstack/bin

GIT VERSION:

git version 2.39.5

  


Listing Git config:

safe.directory=/opt/webstack/html

user.name=Jason Hollis

user.email=jason@ktp.digital

core.repositoryformatversion=0

core.filemode=true

core.bare=false

core.logallrefupdates=true

remote.origin.url=git@github.com:jasonhollis/webstack.git

remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*

branch.master.remote=origin

branch.master.merge=refs/heads/master

  


Trying: git rev-list

5

  


Trying: git log

â¬†ï¸ Version bump: v1.5.4-dev

â¬†ï¸ Version bump: v1.5.3-dev

â¬†ï¸ Version bump: v1.5.2-dev

â¬†ï¸ Version bump: v.1.5.1-dev

â¬†ï¸ Version bump: v1.5.0-dev

root@ssdnodes-605e9a6080011:/opt/webstack/bin#Â 


---
#### [2025-05-24 13:50:41 AEST][v1.5.4-dev]
![](/admin/objectives/images/Screenshot-2025-05-24-at-13.50.25.png)


---
#### [2025-05-24 13:53:07 AEST][v1.5.4-dev]
I have removed the debug line now

