KTP Webstack – Lead Form & Mailgun Release (v1.6.7-dev) Summary

Release Highlights
1. PHPMailer/Mailgun Integration:

Migrated all lead notification email delivery from legacy mail()/SMTP (Office365) to Mailgun using PHPMailer for robust, secure, and future-proof outbound messaging.
Fully supports “From” and “Reply-To” as any valid sender, with instant deliverability and improved handling of aliases (e.g., info@ktp.digital).
2. Home Automation-Centric Lead Form Overhaul:

Redesigned the lead form to focus exclusively on Home Automation, integrating all former networking and access categories as selectable integrations.
Streamlined initial user flow:
“Type of Project” (Updates, New System, or New Build)
“Integration(s) Required” as a multi-select menu (ctrl/cmd click), including Lighting, Blinds, AC/Heating, Access Control, Network/WIFI, Security/CCTV, Irrigation, Pool Equipment, TV/Home Cinema/Audio Entertainment, Appliance Controls, Solar/Energy Management, and “Something else.”
3. Data Quality and UX Enhancements:

Removed company/organization field entirely for a faster and less intimidating user experience.
Split “Your Name” into “First Name” and “Surname,” and now uses “Customer Name” in both lead logs and notification emails.
Added robust, server-side validation for:
Australian phone numbers (10 digits, must start with 0)
Email address format (RFC-compliant)
Valid 4-digit Australian postcodes, with automatic state lookup based on postcode
“Additional details” is now an optional field.
Budget dropdown updated to always use ASCII dollar sign and dash (no more Euro symbols).
4. Structural, Compatibility, and Bugfixes:

PHP compatibility fixes:
Replaced array destructuring with standard index assignment to ensure support for all PHP 7.x/8.x versions.
Fixed parse error with leading zeros in postcode ranges (no more invalid numeric literal on PHP 8+).
Enhanced error feedback for users (including highlighting which fields were missed/invalid).
All data is ASCII-normalized for maximum cross-platform deliverability and readability.
5. Logging & Reliability:

Lead form submissions continue to be appended to /opt/webstack/logs/leads.log for auditability and recovery.
All form data and notifications follow KTP Webstack’s canonical logging, deployment, and atomic update standards.
User/Customer Impact
Forms are simpler and less intimidating: Users see only what they need, with direct validation and instant feedback.
Faster lead handling: More actionable information is collected in a single, clear flow—ready for rapid callback/followup.
No more email delivery problems: All notifications go via Mailgun, bypassing Office365 legacy SMTP/AUTH issues and policy restrictions.
Ready for future: The form is now robust, readable, and modular for further automations, SMS, or Hubspot/CRM integration.
Developer/Operator Notes
All changes are full EOF, versioned, and ready to roll back if needed.
Logging, validation, and mail routines fully comply with KTP’s canonical policies.
All user-facing and admin error handling improved.
Next Steps (Suggested)
Consider adding real-time suburb/postcode auto-complete or state auto-fill for even smoother UX (can be JS/AJAX-powered).
Optional: Integrate webhook or CRM push for automatic lead ingestion.
Optional: Add Google Recaptcha or hCaptcha if you encounter spam submissions.
---
#### [2025-06-01 19:42:18 AEST][v1.6.7]
Resume KTP Webstack dev at v1.6.7-dev (see last release), load all prior workflow, admin, and layout policies, treat this as canonical. Continue with focus on cornerstone/long-form content for Home Assistant, integrations, and SEO.


---
#### [2025-06-03 14:12:40 AEST][v1.6.7]
![](/admin/objectives/images/Clipboard-3-Jun-2025-at-14.12.txt)

